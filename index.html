 <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fundry Books Payment Dashboard</title>
<style>
  body { font-family: Arial, sans-serif; background: #f2f2f2; margin:0; padding:0;}
  header { background:#4CAF50; color:white; padding:1rem; text-align:center; }
  h1 { margin:0; }
  .container { padding:2rem; max-width:1200px; margin:auto; }
  .book-list { display:grid; grid-template-columns: repeat(auto-fit,minmax(250px,1fr)); gap:1rem; }
  .book { background:white; padding:1rem; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
  .book h3 { margin-top:0; }
  .book button { background:#4CAF50; color:white; border:none; padding:0.5rem 1rem; border-radius:5px; cursor:pointer; }
  .book button:hover { background:#45a049; }
  .message { margin-top:1rem; padding:0.5rem; border-radius:5px; }
  .success { background:#d4edda; color:#155724; }
  .error { background:#f8d7da; color:#721c24; }
</style>
</head>
<body>

<header>
  <h1>Fundry Books Payment</h1>
</header>

<div class="container">
  <div class="book-list" id="bookList">
    <!-- Vitabu vitatokea hapa -->
  </div>
  <div id="message"></div>
</div>

<script>
// ====== Configuration ======
const API_TOKEN = "YOUR_API_TOKEN"; // Badilisha na token yako
const USER_ID = 25; // Badilisha na user_id yako
const VENDOR = "TILL61103867";
const REDIRECT_URL = "https://yourdomain.com/success";
const CANCEL_URL = "https://yourdomain.com/cancel";
const WEBHOOK_URL = "https://yourdomain.com/webhook";

// ====== Generate 250 books ======
const books = [];
for(let i=1;i<=250;i++){
  books.push({id:i, title:`Book ${i}`, price:Math.floor(Math.random()*900)+100});
}

// ====== Display books ======
const bookList = document.getElementById("bookList");
books.forEach(book => {
  const div = document.createElement("div");
  div.className = "book";
  div.innerHTML = `
    <h3>${book.title}</h3>
    <p>Price: TZS ${book.price}</p>
    <button onclick="payBook(${book.id})">Lipa</button>
  `;
  bookList.appendChild(div);
});

// ====== Show messages ======
function showMessage(msg,type="success"){
  const messageDiv = document.getElementById("message");
  messageDiv.className = `message ${type}`;
  messageDiv.innerText = msg;
}

// ====== Pay via PalmPesa API ======
async function payBook(bookId){
  const book = books.find(b=>b.id===bookId);
  if(!book) return;

  const orderId = "ORDER-" + Date.now(); // unique order id
  const buyerName = prompt("Ingiza jina lako:");
  const buyerPhone = prompt("Ingiza namba yako (e.g., 255744000000):");
  const buyerEmail = prompt("Ingiza email yako:");

  if(!buyerName || !buyerPhone || !buyerEmail){
    showMessage("Tafadhali jaza taarifa zote!", "error");
    return;
  }

  const payload = {
    user_id: USER_ID,
    vendor: VENDOR,
    order_id: orderId,
    buyer_email: buyerEmail,
    buyer_name: buyerName,
    buyer_phone: buyerPhone,
    amount: book.price,
    currency: "TZS",
    redirect_url: REDIRECT_URL,
    cancel_url: CANCEL_URL,
    webhook: WEBHOOK_URL,
    buyer_remarks: "Online Book Purchase",
    merchant_remarks: book.title,
    no_of_items:1
  };

  try{
    const res = await fetch("https://palmpesa.drmlelwa.co.tz/api/process-payment",{
      method:"POST",
      headers:{
        "Authorization":"Bearer "+API_TOKEN,
        "Content-Type":"application/json",
        "Accept":"application/json"
      },
      body: JSON.stringify(payload)
    });
    const data = await res.json();
    if(data.raw && data.raw.payment_gateway_url){
      window.open(data.raw.payment_gateway_url,"_blank");
      showMessage(`Payment link ya "${book.title}" imetengenezwa, dirisha jipya limefunguliwa.`);
    }else{
      showMessage("Tatizo limetokea, jaribu tena.", "error");
      console.log(data);
    }
  }catch(err){
    showMessage("Network error. Jaribu tena.", "error");
    console.error(err);
  }
}
</script>

</body>
</html>  <div class="container">
  <div class="book-list" id="bookList">
    <!-- Vitabu vitatokea hapa -->
  </div>
  <div id="message"></div>
</div>

<script>
// ====== Configuration ======
const API_TOKEN = "YOUR_API_TOKEN"; // Badilisha na token yako
const USER_ID = 25; // Badilisha na user_id yako
const VENDOR = "TILL61103867";
const REDIRECT_URL = "https://yourdomain.com/success";
const CANCEL_URL = "https://yourdomain.com/cancel";
const WEBHOOK_URL = "https://yourdomain.com/webhook";

// ====== Generate 250 books ======
const books = [];
for(let i=1;i<=250;i++){
  books.push({id:i, title:`Book ${i}`, price:Math.floor(Math.random()*900)+100});
}

// ====== Display books ======
const bookList = document.getElementById("bookList");
books.forEach(book => {
  const div = document.createElement("div");
  div.className = "book";
  div.innerHTML = `
    <h3>${book.title}</h3>
    <p>Price: TZS ${book.price}</p>
    <button onclick="payBook(${book.id})">Lipa</button>
  `;
  bookList.appendChild(div);
});

// ====== Show messages ======
function showMessage(msg,type="success"){
  const messageDiv = document.getElementById("message");
  messageDiv.className = `message ${type}`;
  messageDiv.innerText = msg;
}

// ====== Pay via PalmPesa API ======
async function payBook(bookId){
  const book = books.find(b=>b.id===bookId);
  if(!book) return;

  const orderId = "ORDER-" + Date.now();
  const buyerName = prompt("Ingiza jina lako:");
  const buyerPhone = prompt("Ingiza namba yako (e.g., 255744000000):");
  const buyerEmail = prompt("Ingiza email yako:");

  if(!buyerName || !buyerPhone || !buyerEmail){
    showMessage("Tafadhali jaza taarifa zote!", "error");
    return;
  }

  const payload = {
    user_id: USER_ID,
    vendor: VENDOR,
    order_id: orderId,
    buyer_email: buyerEmail,
    buyer_name: buyerName,
    buyer_phone: buyerPhone,
    amount: book.price,
    currency: "TZS",
    redirect_url: REDIRECT_URL,
    cancel_url: CANCEL_URL,
    webhook: WEBHOOK_URL,
    buyer_remarks: "Online Book Purchase",
    merchant_remarks: book.title,
    no_of_items:1
  };

  try{
    const res = await fetch("https://palmpesa.drmlelwa.co.tz/api/process-payment",{
      method:"POST",
      headers:{
        "Authorization":"Bearer "+API_TOKEN,
        "Content-Type":"application/json",
        "Accept":"application/json"
      },
      body: JSON.stringify(payload)
    });
    const data = await res.json();
    if(data.raw && data.raw.payment_gateway_url){
      window.open(data.raw.payment_gateway_url,"_blank");
      showMessage(`Payment link ya "${book.title}" imetengenezwa, dirisha jipya limefunguliwa.`);
    }else{
      showMessage("Tatizo limetokea, jaribu tena.", "error");
      console.log(data);
    }
  }catch(err){
    showMessage("Network error. Jaribu tena.", "error");
    console.error(err);
  }
}
</script>

</body>
</html>                           
